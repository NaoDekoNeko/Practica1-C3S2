<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Ademar\OneDrive\Desktop\Practica1-C3S2\Sprint5\ReSOSgame\ReSOSgame\Juego.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using static ReSOSGame.Tablero;

namespace ReSOSGame
{
    public abstract class Juego
    {
        public Tablero Tablero { get; }
        public ScoreValidator Validator;

        public int NumberOfEmptyCells
        {
            get
            {
                int numberOfEmptyCells = 0;
                for (int row = 0; row &lt; Tablero.Tamanio; ++row)
                {
                    for (int col = 0; col &lt; Tablero.Tamanio; ++col)
                    {
                        if (Tablero[row, col] == Cell.VACIA)
                        {
                            numberOfEmptyCells++;
                        }
                    }
                }
                return numberOfEmptyCells;
            }
        }
        public Juego(Tablero tablero)
        {
            Tablero = tablero;
            Validator = new ScoreValidator(tablero);
        }

        public abstract void MakeMove(int row,int col ,Cell ficha); // Funcion para realizar un movimiento

        protected bool IsOnBoard(int row, int column)
        {
            return row &gt;= 0 &amp;&amp; row &lt; Tablero.Tamanio &amp;&amp; column &gt;= 0 &amp;&amp; column &lt; Tablero.Tamanio;
        }

        protected bool IsEmpty(int row, int column)
        {
            return Tablero[row, column] == 0;
        }
    }
    public class JuegoSimple : Juego
    {
        public JuegoSimple(Tablero tablero) : base(tablero)
        {
        }
        // Funcion que verifica si se ha ganado el juego simple
        // Funcion que actualiza el estado del juego Simple 
        protected virtual void FinalGameState() 
        {
            if (Validator.FullBoard())
            {
                Tablero.EstadoDeJuego = GameState.EMPATE;
            }
            else
            {
                Tablero.EstadoDeJuego = Tablero.Turno == Jugador.JAZUL ?
                    GameState.GANOAZUL : GameState.GANOROJO;  // Cambia el estado del tablero
            }
        }
        public override void MakeMove(int row, int column, Cell ficha)
        {
            if(!Validator.GameOver()) // Si es el estado de juego es JUGANDO
            {
                if ( IsOnBoard(row,column) &amp;&amp; IsEmpty(row,column)) // Si la posicion :[row,column] esta en el trablero y esa posicion esta vacia
                {
                    Tablero.ValidMove = true; // El atributo ValidMove es verdadero. 
                    Tablero.Ficha = ficha; // rellena el atributo Ficha
                    Tablero[row, column] = ficha; // rellena el grid del tablero con ficha
                    if (Validator.HasOnePoint(row,column,Tablero.Ficha) || Validator.FullBoard()) // Cuando se ha hecho ganado 1 punto o esta el tablero lleno
                    {
                        FinalGameState(); // Actualiza el estado final del tablero
                    }
                    if (Tablero.EstadoDeJuego == GameState.JUGANDO)  // Si el estado de juego es JUGANDO entonces ...
                    {
                        Tablero.Turno = (Tablero.Turno == Jugador.JAZUL) ? Jugador.JROJO : Jugador.JAZUL; // Se hace el cambio de turno
                    }
                }
                else
                {
                    Tablero.ValidMove = false;
                }
            }
            else
            {
                Tablero.ValidMove = false;
            }
        }
    }



    public class JuegoGeneral : Juego
    {
        // Atributos para tener los puntajes de cada jugador
        private int puntajeAzul;
        private int puntajeRojo;
        public JuegoGeneral(Tablero tablero) : base(tablero)
        {
        }
        public int PuntajeAzul =&gt; puntajeAzul;

        public int PuntajeRojo =&gt; puntajeRojo;
        // Funcion que verifica si se ha ganado en un Juego General

        protected virtual void FinalGameState() // Calcula el estado final comparando los puntajes
        {

            if (puntajeAzul &gt; puntajeRojo)
            {
                Tablero.EstadoDeJuego = GameState.GANOAZUL; // Establece que el azul ha ganado
            }
            else if (puntajeAzul &lt; puntajeRojo)
            {
                Tablero.EstadoDeJuego = GameState.GANOROJO; // Establece que el rojo ha ganado
            }
            else if (puntajeRojo==puntajeAzul)
            {
                Tablero.EstadoDeJuego = GameState.EMPATE; // Establece que ha habido un empate
            }
            //sino, el estado de juego es JUGANDO
        }
        public override void MakeMove(int row, int column, Cell ficha)
        {
            if(!Validator.GameOver())
            {
                if (!IsOnBoard(row, column)) return;
                Tablero.ValidMove = true;
                Tablero.Ficha = ficha;
                Tablero[row, column] = ficha;
                if (Validator.HasOnePoint(row, column, Tablero.Ficha)) // Si se ha obtenido un punto
                {
                    //en el turno del jugador JAZUL
                    if (Tablero.Turno == Jugador.JAZUL)
                    {
                        puntajeAzul++; // Se agrega un punto al jugador Azul
                    } //en el turno del jugador JROJO
                    else                        {
                        puntajeRojo++; // Se agrega un punto al jugador Rojo
                    }
                }
                if (Validator.FullBoard())
                {
                    FinalGameState(); // Actualiza el estado del juego cuando el tablero esta lleno
                }
                // Nota: esa funcion detiene el cambio de turno cuando ya se halla ganado o empatado
                if (Tablero.EstadoDeJuego == GameState.JUGANDO) // Si se sigue jugando
                {
                    Tablero.Turno = (Tablero.Turno == Jugador.JAZUL) ? Jugador.JROJO : Jugador.JAZUL; // Se cambia de turno al jugador contrario
                }
            }
            else
            {
                Tablero.ValidMove = false;
            }
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[7,34,7,38,1],[13,13,13,14,1],[14,17,14,44,1],[15,22,15,33,1],[15,35,15,56,1],[15,58,15,63,1],[16,17,16,18,1],[17,26,17,37,1],[17,39,17,60,1],[17,62,17,67,1],[18,21,18,22,1],[19,25,19,61,1],[20,25,20,26,1],[21,29,21,50,1],[22,25,22,26,1],[23,21,23,22,1],[24,17,24,18,1],[25,17,25,43,1],[26,13,26,14,1],[28,9,28,38,1],[29,9,29,10,1],[30,13,30,31,1],[31,13,31,53,1],[32,9,32,10,1],[37,9,37,10,1],[38,13,38,97,1],[39,9,39,10,1],[42,9,42,10,1],[43,13,43,46,1],[44,9,44,10,1],[48,47,48,60,1],[49,9,49,10,1],[50,9,50,10,1],[54,9,54,10,1],[55,13,55,39,1],[56,13,56,14,1],[57,17,57,58,1],[58,13,58,14,1],[60,13,60,14,1],[61,17,62,61,1],[63,13,63,14,1],[64,9,64,10,1],[66,9,66,10,1],[67,13,67,38,1],[68,13,68,14,1],[69,17,69,67,1],[70,17,70,18,1],[71,21,71,46,1],[72,21,72,43,1],[73,21,73,50,1],[74,21,74,98,1],[75,21,75,22,1],[76,25,76,42,1],[77,21,77,22,1],[78,21,78,68,1],[79,21,79,22,1],[80,25,80,106,1],[81,21,81,22,1],[82,17,82,18,1],[84,17,84,18,0],[85,21,85,47,0],[86,17,86,18,0],[87,13,87,14,1],[89,13,89,14,0],[90,17,90,43,0],[91,13,91,14,0],[92,9,92,10,1],[102,48,102,61,1],[103,9,103,10,1],[104,9,104,10,1],[105,35,105,46,1],[107,35,107,46,1],[111,9,111,10,1],[113,13,113,43,1],[114,13,114,14,1],[115,17,115,60,1],[116,13,116,14,1],[117,18,117,48,1],[118,13,118,14,1],[119,17,119,60,1],[120,13,120,14,1],[121,18,121,47,1],[122,13,122,14,1],[123,17,123,58,1],[124,13,124,14,1],[126,9,126,10,1],[128,9,128,10,1],[129,13,129,38,1],[130,13,130,14,1],[131,17,131,45,1],[131,46,131,53,0],[132,17,132,42,1],[133,17,133,39,1],[134,17,134,46,1],[135,17,135,71,1],[136,17,136,18,1],[138,21,138,56,1],[139,21,139,22,1],[140,25,140,39,1],[141,21,141,22,1],[142,49,142,50,1],[143,25,143,39,1],[144,21,144,22,1],[145,17,145,18,1],[146,17,146,43,1],[147,17,147,18,1],[148,21,148,38,1],[149,17,149,18,1],[151,17,151,64,1],[152,17,152,18,1],[153,21,153,102,1],[154,17,154,18,1],[155,13,155,14,1],[157,13,157,14,0],[158,17,158,43,0],[159,13,159,14,0],[160,9,160,10,1]]);
    </script>
  </body>
</html>